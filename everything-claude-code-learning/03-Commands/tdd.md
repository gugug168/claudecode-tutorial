# TDD 测试驱动开发命令

调用 **tdd-guide** agent 强制执行测试驱动开发方法论。

## 此命令做什么

1. **脚手架接口** - 先定义类型/接口
2. **先生成测试** - 编写失败的测试（红色）
3. **最小实现** - 只写足够的代码通过（绿色）
4. **重构** - 在保持测试通过的同时改进代码（重构）
5. **验证覆盖率** - 确保 80%+ 测试覆盖率

## 什么时候使用

使用 `/tdd` 当：
- 实现新功能
- 添加新函数/组件
- 修复 bug（先写重现 bug 的测试）
- 重构现有代码
- 构建关键业务逻辑

## tdd-guide agent 的工作流程

1. **定义接口**用于输入/输出
2. **编写会失败的测试**（因为代码还不存在）
3. **运行测试**并验证它们因正确的原因失败
4. **编写最小实现**使测试通过
5. **运行测试**并验证它们通过
6. **重构**代码同时保持测试通过
7. **检查覆盖率**，如果低于 80% 添加更多测试

## TDD 循环

```
RED → GREEN → REFACTOR → REPEAT

RED:      编写失败的测试
GREEN:    编写最小代码通过
REFACTOR: 改进代码，保持测试通过
REPEAT:   下一个功能/场景
```

## TDD 最佳实践

**应该做：**
- ✅ 在任何实现之前**先写测试**
- ✅ 实现前运行测试并验证它们失败
- ✅ 编写最小代码使测试通过
- ✅ 只在测试通过后重构
- ✅ 添加边缘情况和错误场景
- ✅ 目标 80%+ 覆盖率（关键代码 100%）

**不应该做：**
- ❌ 在测试之前写实现
- ❌ 每次更改后跳过运行测试
- ❌ 一次写太多代码
- ❌ 忽略失败的测试
- ❌ 测试实现细节（应该测试行为）
- ❌ 模拟一切（优先集成测试）

## 要包含的测试类型

**单元测试**（函数级别）：
- 正常路径场景
- 边缘情况（空、null、最大值）
- 错误条件
- 边界值

**集成测试**（组件级别）：
- API 端点
- 数据库操作
- 外部服务调用
- 带 hooks 的 React 组件

**端到端测试**（使用 `/e2e` 命令）：
- 关键用户流程
- 多步骤流程
- 全栈集成

## 覆盖率要求

- **所有代码最低 80% 覆盖率**
- **以下场景要求 100%**：
  - 财务计算
  - 认证逻辑
  - 安全关键代码
  - 核心业务逻辑

## 重要说明

**强制**：测试必须在实现之前编写。TDD 循环是：

1. **RED** - 编写失败的测试
2. **GREEN** - 实现使其通过
3. **REFACTOR** - 改进代码

永远不要跳过红色阶段，永远不要在测试之前写代码。

## 与其他命令的集成

- 先用 `/plan` 了解要构建什么
- 用 `/tdd` 进行测试实现
- 如果出现构建错误，用 `/build-fix`
- 用 `/code-review` 审查实现
- 用 `/test-coverage` 验证覆盖率

## 相关 Agent

此命令调用的 `tdd-guide` agent 位于：
`~/.claude/agents/tdd-guide.md`

以及可以参考 `tdd-workflow` 技能位于：
`~/.claude/skills/tdd-workflow/`
