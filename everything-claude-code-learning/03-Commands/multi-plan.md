# Multi-Plan 多模型协作规划命令

多模型协作规划 - 上下文检索 + 双模型分析 → 生成分步实施计划。

## 核心协议

- **语言协议**：与工具/模型交互时使用英语，用用户的语言与用户沟通
- **强制并行**：Codex/Gemini 调用必须使用 `run_in_background: true`
- **代码主权**：外部模型有**零文件系统写入权限**，所有修改由 Claude 完成
- **仅规划**：此命令允许读取上下文和写入计划文件，但**永远不要修改生产代码**

## 执行工作流

### 阶段 1：完整上下文检索

#### 1.1 提示增强（必须先执行）

调用 `mcp__ace-tool__enhance_prompt` 工具

#### 1.2 上下文检索

调用 `mcp__ace-tool__search_context` 工具

### 阶段 2：多模型协作分析

#### 2.1 分发输入

**并行调用** Codex 和 Gemini（`run_in_background: true`）：

1. **Codex 后端分析**：
   - 聚焦：技术可行性、架构影响、性能考量

2. **Gemini 前端分析**：
   - 聚焦：UI/UX 影响、用户体验、视觉设计

#### 2.4 生成实施计划（Claude 最终版）

综合两个分析，生成**分步实施计划**

## 计划保存

规划完成后，保存计划到：
- **首次规划**：`.claude/plan/<功能名称>.md`
- **迭代版本**：`.claude/plan/<功能名称>-v2.md`

## 关键规则

1. **仅规划，不实现** – 此命令不执行任何代码变更
2. **无 Y/N 提示** – 只呈现计划，让用户决定下一步
3. **信任规则** – 后端遵循 Codex，前端遵循 Gemini
4. 外部模型有**零文件系统写入权限**
