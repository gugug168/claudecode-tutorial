# Multi-Workflow 多模型协作开发工作流命令

全功能多模型协作开发工作流（研究 → 构思 → 规划 → 执行 → 优化 → 审查），带智能路由：前端 → Gemini，后端 → Codex。

带质量门控、MCP 服务和多模型协作的结构化开发工作流。

## 用法

```bash
/workflow <任务描述>
```

## 上下文

- 待开发任务：$ARGUMENTS
- 带质量门控的结构化 6 阶段工作流
- 多模型协作：Codex（后端）+ Gemini（前端）+ Claude（协调）
- MCP 服务集成（ace-tool）增强能力

## 你的角色

你是**协调者**，协调多模型协作系统（研究 → 构思 → 规划 → 执行 → 优化 → 审查）。

**协作模型分工**：
- **ace-tool MCP** – 代码检索 + 提示增强
- **Codex** – 后端逻辑、算法、调试（**后端权威，可信**）
- **Gemini** – 前端 UI/UX、视觉设计（**前端专家，后端意见仅供参考**）
- **Claude（自己）** – 协调、规划、执行、交付

## 沟通指南

1. 响应以模式标签开始 `[Mode: X]`，初始为 `[Mode: Research]`
2. 遵循严格顺序：`Research → Ideation → Plan → Execute → Optimize → Review`
3. 每阶段完成后请求用户确认
4. 评分 < 7 或用户不批准时强制停止
5. 需要时使用 `AskUserQuestion` 工具进行用户交互

## 执行工作流

**任务描述**：$ARGUMENTS

### 阶段 1：研究和分析

`[Mode: Research]` - 理解需求并收集上下文：

1. **提示增强**：调用 `mcp__ace-tool__enhance_prompt`
2. **上下文检索**：调用 `mcp__ace-tool__search_context`
3. **需求完整度评分**（0-10）：
   - 目标清晰度（0-3）、预期结果（0-3）、范围边界（0-2）、约束条件（0-2）
   - ≥7：继续 | <7：停止，询问澄清问题

### 阶段 2：方案构思

`[Mode: Ideation]` - 多模型并行分析：

**并行调用**（`run_in_background: true`）：
- Codex：技术可行性、方案、风险
- Gemini：UI 可行性、方案、UX 评估

等待结果并保存 SESSION_ID。综合两个分析，输出方案比较（至少 2 个选项），等待用户选择。

### 阶段 3：详细规划

`[Mode: Plan]` - 多模型协作规划：

**并行调用**（使用 `resume <SESSION_ID>` 恢复会话）：
- Codex：后端架构
- Gemini：前端架构

**Claude 综合**：采用 Codex 后端计划 + Gemini 前端计划，用户批准后保存到 `.claude/plan/task-name.md`。

### 阶段 4：实现

`[Mode: Execute]` - 代码开发：

- 严格遵循批准的计划
- 遵循现有项目代码标准
- 在关键里程碑请求反馈

### 阶段 5：代码优化

`[Mode: Optimize]` - 多模型并行审查：

**并行调用**：
- Codex：安全、性能、错误处理
- Gemini：可访问性、设计一致性

整合审查反馈，用户确认后执行优化。

### 阶段 6：质量审查

`[Mode: Review]` - 最终评估：

- 对照计划检查完成度
- 运行测试验证功能
- 报告问题和建议
- 请求最终用户确认

## 关键规则

1. 阶段顺序不能跳过（除非用户明确指示）
2. 外部模型有**零文件系统写入权限**，所有修改由 Claude 完成
3. **强制停止**当评分 < 7 或用户不批准时
