# 安装指南

## 快速开始

### 系统要求

- **Claude Code CLI**: v2.1.0 或更高版本
- **Node.js**: v18 或更高版本
- **操作系统**: Windows, macOS, Linux

检查你的版本：
```bash
claude --version
node --version
```

---

## 安装方式

### 方式一：作为插件安装（推荐）

这是最简单的方式：

```bash
# 1. 添加市场
/plugin marketplace add affaan-m/everything-claude-code

# 2. 安装插件
/plugin install everything-claude-code@everything-claude-code

# 3. 验证安装
/plugin list everything-claude-code@everything-claude-code
```

### 方式二：手动安装

如果你想要更多控制：

```bash
# 1. 克隆仓库
git clone https://github.com/affaan-m/everything-claude-code.git
cd everything-claude-code

# 2. 使用安装脚本（推荐）
./install.sh typescript    # 或 python 或 golang
# 可以同时安装多种语言:
# ./install.sh typescript python golang

# 3. 或者手动复制
cp -r agents/*.md ~/.claude/agents/
cp -r rules/common/* ~/.claude/rules/
cp -r rules/typescript/* ~/.claude/rules/
cp commands/*.md ~/.claude/commands/
cp -r skills/* ~/.claude/skills/
```

---

## 规则安装（重要！）

**重要**: Claude Code 插件系统不支持通过插件分发 `rules`。你必须手动安装规则：

```bash
# 克隆仓库
git clone https://github.com/affaan-m/everything-claude-code.git

# 使用安装脚本
./install.sh typescript    # 安装 common + typescript 规则

# 或手动安装
cp -r everything-claude-code/rules/common/* ~/.claude/rules/
cp -r everything-claude-code/rules/typescript/* ~/.claude/rules/
```

---

## 钩子配置

如果手动安装，需要添加钩子到 `~/.claude/settings.json`：

```json
{
  "hooks": {
    "PreToolUse": [
      {
        "matcher": "Bash",
        "hooks": [
          {
            "type": "command",
            "command": "node ~/.claude/hooks/check-dev-server.js"
          }
        ]
      }
    ],
    "PostToolUse": [
      {
        "matcher": "Edit",
        "hooks": [
          {
            "type": "command",
            "command": "node ~/.claude/hooks/format-on-edit.js"
          }
        ]
      }
    ]
  }
}
```

---

## 验证安装

### 检查代理

```bash
# 列出已安装的代理
ls ~/.claude/agents/
```

应该看到：
- planner.md
- architect.md
- tdd-guide.md
- code-reviewer.md
- ... 等 13 个文件

### 检查命令

```bash
# 列出已安装的命令
ls ~/.claude/commands/
```

应该看到：
- plan.md
- tdd.md
- code-review.md
- ... 等 31 个文件

### 检查规则

```bash
# 列出已安装的规则
ls ~/.claude/rules/
```

应该看到：
- common/ 目录
- typescript/ 或 python/ 或 golang/ 目录

### 测试命令

```bash
# 尝试一个命令
/plan "测试功能"
```

---

## 包管理器配置

插件会自动检测你的包管理器（npm, pnpm, yarn, bun）。优先级：

1. 环境变量: `CLAUDE_PACKAGE_MANAGER`
2. 项目配置: `.claude/package-manager.json`
3. package.json: `packageManager` 字段
4. 锁文件检测
5. 全局配置: `~/.claude/package-manager.json`

手动设置：

```bash
# 通过环境变量
export CLAUDE_PACKAGE_MANAGER=pnpm

# 通过全局配置
node scripts/setup-package-manager.js --global pnpm

# 通过项目配置
node scripts/setup-package-manager.js --project bun
```

或使用 `/setup-pm` 命令。

---

## 跨平台支持

本插件完全支持 Windows、macOS 和 Linux。所有钩子和脚本都用 Node.js 编写以获得最大兼容性。

---

## 故障排除

### 问题: 钩子不工作 / 看到 "Duplicate hooks file" 错误

**解决方案**: 不要在 `.claude-plugin/plugin.json` 中添加 `"hooks"` 字段。Claude Code v2.1+ 会自动加载 `hooks/hooks.json`。

### 问题: 上下文窗口缩小 / Claude 上下文用完

**解决方案**: 禁用未使用的 MCP 服务器：

```json
// 在项目的 .claude/settings.json 中
{
  "disabledMcpServers": ["supabase", "railway", "vercel"]
}
```

保持 MCP 服务器 < 10 个，活跃工具 < 80 个。

### 问题: 命令不识别

**解决方案**:
1. 确认命令文件在 `~/.claude/commands/` 目录
2. 重启 Claude Code
3. 检查命令文件格式正确

---

## 下一步

安装完成后：
1. 阅读 [常用工作流](./常用工作流.md)
2. 了解 [Token 优化](./Token优化.md)
3. 尝试 `/plan "你的第一个功能"`
