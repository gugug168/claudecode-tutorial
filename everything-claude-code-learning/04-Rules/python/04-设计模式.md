# Python è®¾è®¡æ¨¡å¼

> æœ¬æ–‡ä»¶åœ¨ [common/patterns.md](../common/patterns.md) åŸºç¡€ä¸Šï¼Œå¢åŠ äº† Python ç‰¹å®šçš„å†…å®¹ã€‚

---

## ğŸ“‹ è§„åˆ™è¯´æ˜

| é¡¹ç›® | å†…å®¹ |
|------|------|
| **ç”¨é€”** | Python è¯­è¨€ç‰¹å®šçš„è®¾è®¡æ¨¡å¼ |
| **ä½¿ç”¨æ—¶æœº** | ç¼–å†™ Python ä»£ç ã€æ¶æ„è®¾è®¡æ—¶å‚è€ƒ |
| **æ ¸å¿ƒèƒ½åŠ›** | Protocolã€Dataclassã€ä¸Šä¸‹æ–‡ç®¡ç†å™¨ã€ç”Ÿæˆå™¨ |
| **é€‚ç”¨èŒƒå›´** | Python è¯­è¨€é¡¹ç›® |

---

## ğŸ”§ å…ƒæ•°æ®è¯´æ˜

`paths` å­—æ®µæŒ‡å®šæ­¤è§„åˆ™é€‚ç”¨äºå“ªäº› Python æ–‡ä»¶è·¯å¾„ï¼š

```yaml
paths:
  - "**/*.py"      # Python æºä»£ç æ–‡ä»¶
  - "**/*.pyi"     # Python ç±»å‹å­˜æ ¹æ–‡ä»¶
```

---

## ğŸ¦† Protocolï¼ˆé¸­å­ç±»å‹ï¼‰

### ä»€ä¹ˆæ˜¯é¸­å­ç±»å‹ï¼Ÿ

**"é¸­å­ç±»å‹"** æ˜¯ä¸€ä¸ªç¼–ç¨‹æ¦‚å¿µï¼š

> "å¦‚æœå®ƒèµ°èµ·è·¯æ¥åƒé¸­å­ï¼Œå«èµ·æ¥åƒé¸­å­ï¼Œé‚£å®ƒå°±æ˜¯é¸­å­ã€‚"

åœ¨ Python ä¸­ï¼Œè¿™æ„å‘³ç€ï¼š
- ä¸éœ€è¦æ˜¾å¼ç»§æ‰¿æŸä¸ªç±»
- åªè¦å¯¹è±¡æœ‰éœ€è¦çš„æ–¹æ³•ï¼Œå°±å¯ä»¥ä½¿ç”¨
- æ›´çµæ´»ã€æ›´åŠ¨æ€

### ä¼ ç»Ÿæ–¹å¼ vs Protocol

#### ä¼ ç»Ÿæ–¹å¼ï¼ˆç»§æ‰¿ï¼‰

```python
from abc import ABC, abstractmethod

class Repository(ABC):
    """æŠ½è±¡åŸºç±»ï¼šå®šä¹‰æ¥å£"""

    @abstractmethod
    def find_by_id(self, id: str) -> dict | None:
        """æ ¹æ® ID æŸ¥æ‰¾"""
        pass

    @abstractmethod
    def save(self, entity: dict) -> dict:
        """ä¿å­˜å®ä½“"""
        pass

# å¿…é¡»æ˜¾å¼ç»§æ‰¿
class UserRepository(Repository):
    def find_by_id(self, id: str) -> dict | None:
        # å®ç°ä»£ç 
        return {"id": id, "name": "å¼ ä¸‰"}

    def save(self, entity: dict) -> dict:
        # å®ç°ä»£ç 
        return entity
```

**ç¼ºç‚¹ï¼š**
- å¿…é¡»æ˜¾å¼ç»§æ‰¿æŠ½è±¡ç±»
- ä¸å¤Ÿçµæ´»
- ç±»å‹æ£€æŸ¥æ—¶éœ€è¦ç»§æ‰¿å…³ç³»

#### Protocol æ–¹å¼ï¼ˆæ¨èï¼‰

```python
from typing import Protocol

class Repository(Protocol):
    """Protocolï¼šå®šä¹‰æ¥å£è§„èŒƒ"""

    def find_by_id(self, id: str) -> dict | None:
        """æ ¹æ® ID æŸ¥æ‰¾"""
        ...

    def save(self, entity: dict) -> dict:
        """ä¿å­˜å®ä½“"""
        ...

# ä¸éœ€è¦ç»§æ‰¿ï¼Œåªè¦å®ç°ç›¸åº”æ–¹æ³•å³å¯
class UserRepository:
    """ç”¨æˆ·ä»“å‚¨ï¼ˆæ— éœ€ç»§æ‰¿ Repositoryï¼‰"""

    def find_by_id(self, id: str) -> dict | None:
        return {"id": id, "name": "å¼ ä¸‰"}

    def save(self, entity: dict) -> dict:
        return entity

# ä½¿ç”¨
def get_user(repo: Repository, user_id: str):
    """ä»»ä½•å®ç°äº† Repository æ–¹æ³•çš„å¯¹è±¡éƒ½å¯ä»¥ä¼ å…¥"""
    return repo.find_by_id(user_id)

# å¯ä»¥ä¼ å…¥ä»»ä½•å®ç°äº†ç›¸åº”æ–¹æ³•çš„ç±»
user_repo = UserRepository()
print(get_user(user_repo, "123"))  # âœ… å·¥ä½œ
```

**ä¼˜ç‚¹ï¼š**
- ä¸éœ€è¦æ˜¾å¼ç»§æ‰¿
- æ›´çµæ´»ï¼Œå¯ä»¥éšæ—¶æ·»åŠ æ–°å®ç°
- ç±»å‹æ£€æŸ¥å™¨ï¼ˆå¦‚ mypyï¼‰ä¼šéªŒè¯æ¥å£ä¸€è‡´æ€§

### Protocol è¯¦è§£

#### 1. å®šä¹‰ Protocol

```python
from typing import Protocol

class Drawable(Protocol):
    """å¯ç»˜åˆ¶å¯¹è±¡åè®®"""

    def draw(self) -> str:
        """ç»˜åˆ¶æ–¹æ³•"""
        ...
```

#### 2. å®ç°åè®®ï¼ˆæ— éœ€ç»§æ‰¿ï¼‰

```python
class Circle:
    """åœ†å½¢ï¼ˆæ— éœ€ç»§æ‰¿ Drawableï¼‰"""

    def draw(self) -> str:
        return "ç»˜åˆ¶åœ†å½¢"

class Rectangle:
    """çŸ©å½¢ï¼ˆæ— éœ€ç»§æ‰¿ Drawableï¼‰"""

    def draw(self) -> str:
        return "ç»˜åˆ¶çŸ©å½¢"
```

#### 3. ä½¿ç”¨åè®®

```python
def render(shape: Drawable):
    """æ¸²æŸ“ä»»ä½•å¯ç»˜åˆ¶çš„å¯¹è±¡"""
    print(shape.draw())

# ä»»ä½•æœ‰ draw æ–¹æ³•çš„å¯¹è±¡éƒ½å¯ä»¥ä½¿ç”¨
circle = Circle()
rectangle = Rectangle()

render(circle)      # è¾“å‡ºï¼šç»˜åˆ¶åœ†å½¢
render(rectangle)   # è¾“å‡ºï¼šç»˜åˆ¶çŸ©å½¢
```

### Protocol ä¸æŠ½è±¡åŸºç±»å¯¹æ¯”

| ç‰¹æ€§ | Protocol | æŠ½è±¡åŸºç±» (ABC) |
|------|----------|---------------|
| ç»§æ‰¿è¦æ±‚ | ä¸éœ€è¦ï¼ˆéšå¼ï¼‰ | å¿…é¡»æ˜¾å¼ç»§æ‰¿ |
| çµæ´»æ€§ | é«˜ï¼ˆåŠ¨æ€æ£€æŸ¥ï¼‰ | ä½ï¼ˆé™æ€ç»§æ‰¿ï¼‰ |
| ç±»å‹æ£€æŸ¥ | è¿è¡Œæ—¶ + é™æ€ | ä¸»è¦æ˜¯è¿è¡Œæ—¶ |
| é€‚ç”¨åœºæ™¯ | ç»“æ„åŒ–ç±»å‹ï¼ˆé¸­å­ç±»å‹ï¼‰ | è¡Œä¸ºç±»å‹ï¼ˆä¼ ç»Ÿ OOPï¼‰ |
| æ¨èåº¦ | âœ… æ¨èï¼ˆPython 3.8+ï¼‰ | âš ï¸ ä¼ ç»Ÿåœºæ™¯ |

---

## ğŸ“¦ Dataclass ä½œä¸º DTO

### ä»€ä¹ˆæ˜¯ DTOï¼Ÿ

**DTOï¼ˆData Transfer Objectï¼Œæ•°æ®ä¼ è¾“å¯¹è±¡ï¼‰** æ˜¯ç”¨äºå°è£…æ•°æ®çš„ç±»ã€‚

### ä»€ä¹ˆæ˜¯ Dataclassï¼Ÿ

**`@dataclass`** æ˜¯ Python 3.7+ çš„è£…é¥°å™¨ï¼Œç”¨äºè‡ªåŠ¨åˆ›å»ºæ•°æ®ç±»ã€‚

### ä¼ ç»Ÿæ–¹å¼ vs Dataclass

#### ä¼ ç»Ÿæ–¹å¼ï¼ˆç¹çï¼‰

```python
class UserRequest:
    """ç”¨æˆ·è¯·æ±‚ç±»ï¼ˆä¼ ç»Ÿæ–¹å¼ï¼‰"""

    def __init__(self, name: str, email: str, age: int | None = None):
        self.name = name
        self.email = email
        self.age = age

    def __repr__(self):
        return f"UserRequest(name={self.name}, email={self.email}, age={self.age})"

    def __eq__(self, other):
        if not isinstance(other, UserRequest):
            return False
        return (self.name, self.email, self.age) == (other.name, other.email, other.age)
```

**ç¼ºç‚¹ï¼š**
- éœ€è¦æ‰‹åŠ¨ç¼–å†™ `__init__`ã€`__repr__`ã€`__eq__` ç­‰æ–¹æ³•
- ä»£ç å†—é•¿ï¼Œå®¹æ˜“å‡ºé”™

#### Dataclass æ–¹å¼ï¼ˆç®€æ´ï¼‰

```python
from dataclasses import dataclass

@dataclass
class UserRequest:
    """ç”¨æˆ·è¯·æ±‚ç±»ï¼ˆdataclass æ–¹å¼ï¼‰"""
    name: str
    email: str
    age: int | None = None  # å¯é€‰å­—æ®µå¸¦é»˜è®¤å€¼
```

**ä¼˜ç‚¹ï¼š**
- è‡ªåŠ¨ç”Ÿæˆ `__init__`ã€`__repr__`ã€`__eq__` ç­‰æ–¹æ³•
- ä»£ç ç®€æ´ã€æ˜“è¯»
- ç±»å‹æç¤ºå‹å¥½

### Dataclass ä½¿ç”¨ç¤ºä¾‹

#### 1. åŸºæœ¬ç”¨æ³•

```python
from dataclasses import dataclass

@dataclass
class CreateUserRequest:
    """åˆ›å»ºç”¨æˆ·è¯·æ±‚"""
    name: str
    email: str
    age: int | None = None  # å¯é€‰å­—æ®µ

# ä½¿ç”¨
request = CreateUserRequest(
    name="å¼ ä¸‰",
    email="zhangsan@example.com"
)

print(request)
# è¾“å‡ºï¼šCreateUserRequest(name='å¼ ä¸‰', email='zhangsan@example.com', age=None)
```

#### 2. ä¸å¯å˜ Dataclass

```python
from dataclasses import dataclass

@dataclass(frozen=True)
class Point:
    """åæ ‡ç‚¹ï¼ˆä¸å¯å˜ï¼‰"""
    x: float
    y: float

point = Point(x=10.0, y=20.0)

# å°è¯•ä¿®æ”¹ä¼šæŠ¥é”™
# point.x = 15.0  # âŒ FrozenInstanceError: cannot assign to field 'x'
```

#### 3. å¸¦éªŒè¯çš„ Dataclass

```python
from dataclasses import dataclass

@dataclass
class User:
    """ç”¨æˆ·ç±»ï¼ˆå¸¦éªŒè¯ï¼‰"""
    name: str
    email: str
    age: int

    def __post_init__(self):
        """åˆå§‹åŒ–åéªŒè¯"""
        if self.age < 0:
            raise ValueError("å¹´é¾„ä¸èƒ½ä¸ºè´Ÿæ•°")
        if "@" not in self.email:
            raise ValueError("é‚®ç®±æ ¼å¼ä¸æ­£ç¡®")

# ä½¿ç”¨
try:
    user = User(name="å¼ ä¸‰", email="invalid", age=25)
except ValueError as e:
    print(f"é”™è¯¯ï¼š{e}")  # é”™è¯¯ï¼šé‚®ç®±æ ¼å¼ä¸æ­£ç¡®
```

#### 4. Dataclass ç»§æ‰¿

```python
from dataclasses import dataclass

@dataclass
class Person:
    """äººç±»"""
    name: str
    age: int

@dataclass
class Employee(Person):
    """å‘˜å·¥ï¼ˆç»§æ‰¿äººç±»ï¼‰"""
    employee_id: str
    department: str

# ä½¿ç”¨
employee = Employee(
    name="æå››",
    age=30,
    employee_id="E12345",
    department="æŠ€æœ¯éƒ¨"
)

print(employee)
# è¾“å‡ºï¼šEmployee(name='æå››', age=30, employee_id='E12345', department='æŠ€æœ¯éƒ¨')
```

### Dataclass ç‰¹æ€§å¯¹æ¯”

| ç‰¹æ€§ | æ™®é€šç±» | Dataclass |
|------|--------|-----------|
| è‡ªåŠ¨ç”Ÿæˆ `__init__` | âŒ éœ€æ‰‹åŠ¨ç¼–å†™ | âœ… è‡ªåŠ¨ç”Ÿæˆ |
| è‡ªåŠ¨ç”Ÿæˆ `__repr__` | âŒ éœ€æ‰‹åŠ¨ç¼–å†™ | âœ… è‡ªåŠ¨ç”Ÿæˆ |
| è‡ªåŠ¨ç”Ÿæˆ `__eq__` | âŒ éœ€æ‰‹åŠ¨ç¼–å†™ | âœ… è‡ªåŠ¨ç”Ÿæˆ |
| æ”¯æŒä¸å¯å˜æ€§ | âŒ éœ€é¢å¤–å®ç° | âœ… `frozen=True` |
| ç±»å‹æç¤º | âœ… æ”¯æŒ | âœ… æ”¯æŒ |
| ä»£ç ç®€æ´åº¦ | âš ï¸ å†—é•¿ | âœ… ç®€æ´ |

---

## ğŸ”§ ä¸Šä¸‹æ–‡ç®¡ç†å™¨

### ä»€ä¹ˆæ˜¯ä¸Šä¸‹æ–‡ç®¡ç†å™¨ï¼Ÿ

**ä¸Šä¸‹æ–‡ç®¡ç†å™¨ï¼ˆContext Managerï¼‰** æ˜¯ç”¨äºç®¡ç†èµ„æºçš„å¯¹è±¡ï¼Œé€šå¸¸ä¸ `with` è¯­å¥ä¸€èµ·ä½¿ç”¨ã€‚

### ä¸ºä»€ä¹ˆä½¿ç”¨ä¸Šä¸‹æ–‡ç®¡ç†å™¨ï¼Ÿ

**å¥½å¤„ï¼š**
- è‡ªåŠ¨èµ„æºç®¡ç†ï¼ˆè‡ªåŠ¨å…³é—­æ–‡ä»¶ã€é‡Šæ”¾é”ç­‰ï¼‰
- å¼‚å¸¸å®‰å…¨ï¼ˆå³ä½¿å‘ç”Ÿé”™è¯¯ä¹Ÿä¼šæ¸…ç†èµ„æºï¼‰
- ä»£ç æ›´ç®€æ´

### å¸¸è§ä¸Šä¸‹æ–‡ç®¡ç†å™¨

#### 1. æ–‡ä»¶æ“ä½œ

```python
# ä½¿ç”¨ with è¯­å¥ï¼ˆæ¨èï¼‰
with open("file.txt", "r") as f:
    content = f.read()
    # æ–‡ä»¶ä¼šè‡ªåŠ¨å…³é—­ï¼Œå³ä½¿å‘ç”Ÿé”™è¯¯

# ä¸ä½¿ç”¨ withï¼ˆä¸æ¨èï¼‰
f = open("file.txt", "r")
try:
    content = f.read()
finally:
    f.close()  # å¿…é¡»æ‰‹åŠ¨å…³é—­
```

#### 2. çº¿ç¨‹é”

```python
import threading

lock = threading.Lock()

# ä½¿ç”¨ withï¼ˆæ¨èï¼‰
with lock:
    # ä¸´ç•ŒåŒºä»£ç 
    print("é”å·²è·å–")

# é”ä¼šè‡ªåŠ¨é‡Šæ”¾

# ä¸ä½¿ç”¨ withï¼ˆä¸æ¨èï¼‰
lock.acquire()
try:
    print("é”å·²è·å–")
finally:
    lock.release()  # å¿…é¡»æ‰‹åŠ¨é‡Šæ”¾
```

### è‡ªå®šä¹‰ä¸Šä¸‹æ–‡ç®¡ç†å™¨

#### æ–¹æ³• 1ï¼šä½¿ç”¨ç±»å®ç°

```python
class Timer:
    """è®¡æ—¶å™¨ä¸Šä¸‹æ–‡ç®¡ç†å™¨"""

    def __init__(self, name: str):
        self.name = name
        self.start_time = None

    def __enter__(self):
        """è¿›å…¥ with è¯­å¥æ—¶è°ƒç”¨"""
        import time
        self.start_time = time.time()
        print(f"[{self.name}] å¼€å§‹...")
        return self

    def __exit__(self, exc_type, exc_val, exc_tb):
        """é€€å‡º with è¯­å¥æ—¶è°ƒç”¨"""
        import time
        elapsed = time.time() - self.start_time
        print(f"[{self.name}] å®Œæˆï¼Œè€—æ—¶ {elapsed:.2f} ç§’")
        return False  # å¦‚æœè¿”å› Trueï¼Œä¼šæŠ‘åˆ¶å¼‚å¸¸

# ä½¿ç”¨
with Timer("æ•°æ®å¤„ç†"):
    # æ¨¡æ‹Ÿè€—æ—¶æ“ä½œ
    sum(range(10**6))

# è¾“å‡ºï¼š
# [æ•°æ®å¤„ç†] å¼€å§‹...
# [æ•°æ®å¤„ç†] å®Œæˆï¼Œè€—æ—¶ 0.05 ç§’
```

#### æ–¹æ³• 2ï¼šä½¿ç”¨è£…é¥°å™¨ï¼ˆæ›´ç®€æ´ï¼‰

```python
from contextlib import contextmanager
import time

@contextmanager
def timer(name: str):
    """è®¡æ—¶å™¨ä¸Šä¸‹æ–‡ç®¡ç†å™¨ï¼ˆä½¿ç”¨è£…é¥°å™¨ï¼‰"""
    start_time = time.time()
    print(f"[{name}] å¼€å§‹...")
    try:
        yield  # è¿”å›æ§åˆ¶æƒç»™ with å—
    finally:
        elapsed = time.time() - start_time
        print(f"[{name}] å®Œæˆï¼Œè€—æ—¶ {elapsed:.2f} ç§’")

# ä½¿ç”¨
with timer("æ•°æ®å¤„ç†"):
    sum(range(10**6))
```

### ä¸Šä¸‹æ–‡ç®¡ç†å™¨åº”ç”¨åœºæ™¯

| åœºæ™¯ | ç¤ºä¾‹ | è¯´æ˜ |
|------|------|------|
| æ–‡ä»¶æ“ä½œ | `with open(...)` | è‡ªåŠ¨å…³é—­æ–‡ä»¶ |
| æ•°æ®åº“è¿æ¥ | `with db.connect()` | è‡ªåŠ¨å…³é—­è¿æ¥ |
| çº¿ç¨‹é” | `with lock:` | è‡ªåŠ¨é‡Šæ”¾é” |
| ä¸´æ—¶ç›®å½• | `with TemporaryDirectory()` | è‡ªåŠ¨æ¸…ç†ä¸´æ—¶æ–‡ä»¶ |
| è®¡æ—¶å™¨ | `with timer()` | è‡ªåŠ¨è®¡ç®—è€—æ—¶ |

---

## âš¡ ç”Ÿæˆå™¨

### ä»€ä¹ˆæ˜¯ç”Ÿæˆå™¨ï¼Ÿ

**ç”Ÿæˆå™¨ï¼ˆGeneratorï¼‰** æ˜¯ä¸€ç§ç‰¹æ®Šçš„è¿­ä»£å™¨ï¼Œå¯ä»¥æƒ°æ€§åœ°ç”Ÿæˆå€¼ã€‚

### ä¸ºä»€ä¹ˆä½¿ç”¨ç”Ÿæˆå™¨ï¼Ÿ

**å¥½å¤„ï¼š**
- **å†…å­˜é«˜æ•ˆ**ï¼šä¸éœ€è¦ä¸€æ¬¡æ€§ç”Ÿæˆæ‰€æœ‰å€¼
- **æƒ°æ€§æ±‚å€¼**ï¼šåªåœ¨éœ€è¦æ—¶ç”Ÿæˆå€¼
- **æ— é™åºåˆ—**ï¼šå¯ä»¥è¡¨ç¤ºæ— é™é•¿çš„åºåˆ—

### åˆ›å»ºç”Ÿæˆå™¨

#### æ–¹æ³• 1ï¼šç”Ÿæˆå™¨å‡½æ•°

```python
def count_up_to(n: int):
    """ç”Ÿæˆ 1 åˆ° n çš„æ•°å­—"""
    count = 1
    while count <= n:
        yield count  # yield å…³é”®å­—ç”Ÿæˆå€¼
        count += 1

# ä½¿ç”¨
for num in count_up_to(5):
    print(num)

# è¾“å‡ºï¼š1, 2, 3, 4, 5
```

**è¯´æ˜ï¼š**
- ä½¿ç”¨ `yield` å…³é”®å­—ï¼ˆä¸æ˜¯ `return`ï¼‰
- æ¯æ¬¡è°ƒç”¨ `yield` ä¼šæš‚åœå‡½æ•°ï¼Œä¿ç•™çŠ¶æ€
- ä¸‹æ¬¡è¿­ä»£æ—¶ä»æš‚åœå¤„ç»§ç»­

#### æ–¹æ³• 2ï¼šç”Ÿæˆå™¨è¡¨è¾¾å¼

```python
# ç”Ÿæˆå™¨è¡¨è¾¾å¼ï¼ˆç±»ä¼¼åˆ—è¡¨æ¨å¯¼å¼ï¼Œä½†ä½¿ç”¨åœ†æ‹¬å·ï¼‰
squares = (x**2 for x in range(5))

# ä½¿ç”¨
for square in squares:
    print(square)

# è¾“å‡ºï¼š0, 1, 4, 9, 16
```

### ç”Ÿæˆå™¨ vs åˆ—è¡¨

```python
# åˆ—è¡¨ï¼ˆä¸€æ¬¡æ€§ç”Ÿæˆæ‰€æœ‰å€¼ï¼Œå ç”¨å†…å­˜ï¼‰
def get_squares_list(n):
    return [x**2 for x in range(n)]

squares_list = get_squares_list(10**6)
print(f"åˆ—è¡¨å¤§å°: {len(squares_list)} ä¸ªå…ƒç´ ")

# ç”Ÿæˆå™¨ï¼ˆæƒ°æ€§ç”Ÿæˆï¼ŒèŠ‚çœå†…å­˜ï¼‰
def get_squares_gen(n):
    for x in range(n):
        yield x**2

squares_gen = get_squares_gen(10**6)
print(f"ç”Ÿæˆå™¨å¯¹è±¡: {squares_gen}")  # ä¸å ç”¨å¤§é‡å†…å­˜
```

**å¯¹æ¯”è¡¨æ ¼ï¼š**

| ç‰¹æ€§ | åˆ—è¡¨ | ç”Ÿæˆå™¨ |
|------|------|--------|
| å†…å­˜å ç”¨ | é«˜ï¼ˆå­˜å‚¨æ‰€æœ‰å€¼ï¼‰ | ä½ï¼ˆæŒ‰éœ€ç”Ÿæˆï¼‰ |
| è®¡ç®—æ—¶æœº | ç«‹å³è®¡ç®— | æƒ°æ€§è®¡ç®— |
| å¯è¿­ä»£æ¬¡æ•° | å¤šæ¬¡ | å•æ¬¡ï¼ˆè€—å°½åä¸èƒ½é‡ç”¨ï¼‰ |
| é€‚ç”¨åœºæ™¯ | å°æ•°æ®é›† | å¤§æ•°æ®é›†ã€æ— é™åºåˆ— |

### ç”Ÿæˆå™¨åº”ç”¨åœºæ™¯

#### 1. å¤„ç†å¤§æ–‡ä»¶

```python
def read_large_file(file_path: str):
    """é€è¡Œè¯»å–å¤§æ–‡ä»¶ï¼ˆä¸åŠ è½½åˆ°å†…å­˜ï¼‰"""
    with open(file_path, "r") as f:
        for line in f:
            yield line.strip()

# ä½¿ç”¨
for line in read_large_file("huge_file.txt"):
    print(line)
    # æ¯æ¬¡åªå¤„ç†ä¸€è¡Œï¼Œå†…å­˜å ç”¨æ’å®š
```

#### 2. æ— é™åºåˆ—

```python
def fibonacci():
    """æ–æ³¢é‚£å¥‘æ•°åˆ—ï¼ˆæ— é™ï¼‰"""
    a, b = 0, 1
    while True:
        yield a
        a, b = b, a + b

# ä½¿ç”¨
fib = fibonacci()
for i, num in enumerate(fib):
    if i >= 10:  # åªå–å‰ 10 ä¸ª
        break
    print(num)

# è¾“å‡ºï¼š0, 1, 1, 2, 3, 5, 8, 13, 21, 34
```

#### 3. æ•°æ®ç®¡é“

```python
def read_lines(file_path: str):
    """è¯»å–æ–‡ä»¶è¡Œ"""
    with open(file_path, "r") as f:
        for line in f:
            yield line.strip()

def filter_lines(lines, keyword: str):
    """è¿‡æ»¤åŒ…å«å…³é”®è¯çš„è¡Œ"""
    for line in lines:
        if keyword in line:
            yield line

def transform_lines(lines):
    """è½¬æ¢è¡Œå†…å®¹"""
    for line in lines:
        yield line.upper()

# é“¾å¼ä½¿ç”¨
lines = read_lines("data.txt")
filtered = filter_lines(lines, "error")
transformed = transform_lines(filtered)

for line in transformed:
    print(line)
    # é€è¡Œå¤„ç†ï¼Œå†…å­˜å ç”¨æ’å®š
```

---

## ğŸ“š å‚è€ƒèµ„æº

- **æŠ€èƒ½æ–‡æ¡£**ï¼šæŸ¥çœ‹ `python-patterns` æŠ€èƒ½è·å–å…¨é¢çš„æ¨¡å¼ï¼ˆåŒ…æ‹¬è£…é¥°å™¨ã€å¹¶å‘å’ŒåŒ…ç»„ç»‡ï¼‰
- **PEP 544 - Protocol**ï¼šhttps://peps.python.org/pep-0544/
- **Dataclasses æ–‡æ¡£**ï¼šhttps://docs.python.org/3/library/dataclasses.html
- **ä¸Šä¸‹æ–‡ç®¡ç†å™¨æ–‡æ¡£**ï¼šhttps://docs.python.org/3/reference/datamodel.html#context-managers
- **ç”Ÿæˆå™¨æ–‡æ¡£**ï¼šhttps://docs.python.org/3/howto/functional.html#generators

---

## ğŸ’¡ å­¦ä¹ æç¤º

**åˆå­¦è€…å»ºè®®ï¼š**

1. **Protocol**ï¼šä¼˜å…ˆä½¿ç”¨ Protocol è€ŒéæŠ½è±¡åŸºç±»ï¼ˆPython 3.8+ï¼‰
2. **Dataclass**ï¼šç”¨äºæ•°æ®ç±»ï¼Œå‡å°‘æ ·æ¿ä»£ç 
3. **ä¸Šä¸‹æ–‡ç®¡ç†å™¨**ï¼šç”¨äºèµ„æºç®¡ç†ï¼Œç¡®ä¿èµ„æºæ­£ç¡®é‡Šæ”¾
4. **ç”Ÿæˆå™¨**ï¼šå¤„ç†å¤§æ•°æ®é›†æ—¶ä½¿ç”¨ï¼ŒèŠ‚çœå†…å­˜

**å¸¸è§é”™è¯¯ï¼š**

| é”™è¯¯ | è¯´æ˜ | ä¿®æ­£æ–¹æ³• |
|------|------|----------|
| è¿‡åº¦ä½¿ç”¨ç»§æ‰¿ | Python ä¸åƒ Java éœ€è¦å¤§é‡ç»§æ‰¿ | ä½¿ç”¨ Protocol æˆ–ç»„åˆ |
| æ‰‹åŠ¨ç¼–å†™æ•°æ®ç±» | å†—é•¿ä¸”å®¹æ˜“å‡ºé”™ | ä½¿ç”¨ `@dataclass` |
| å¿˜è®°å…³é—­æ–‡ä»¶ | èµ„æºæ³„æ¼ | ä½¿ç”¨ `with` è¯­å¥ |
| åˆ—è¡¨å ç”¨è¿‡å¤šå†…å­˜ | å¤§æ•°æ®é›†å¯¼è‡´å†…å­˜ä¸è¶³ | ä½¿ç”¨ç”Ÿæˆå™¨ |

---

## âœ… æ£€æŸ¥æ¸…å•

åœ¨ç¼–å†™ä»£ç æ—¶ï¼Œç¡®è®¤ä»¥ä¸‹äº‹é¡¹ï¼š

- [ ] ä¼˜å…ˆä½¿ç”¨ Protocol å®šä¹‰æ¥å£ï¼ˆè€ŒéæŠ½è±¡åŸºç±»ï¼‰
- [ ] ä½¿ç”¨ `@dataclass` å®šä¹‰æ•°æ®ä¼ è¾“å¯¹è±¡
- [ ] èµ„æºç®¡ç†ä½¿ç”¨ä¸Šä¸‹æ–‡ç®¡ç†å™¨ï¼ˆ`with` è¯­å¥ï¼‰
- [ ] å¤§æ•°æ®é›†ä½¿ç”¨ç”Ÿæˆå™¨ï¼ˆè€Œéåˆ—è¡¨ï¼‰
- [ ] ä¸å¯å˜æ•°æ®ä½¿ç”¨ `frozen=True` çš„ dataclass
- [ ] ä»£ç éµå¾ª Python æƒ¯ç”¨æ³•ï¼ˆPythonicï¼‰
