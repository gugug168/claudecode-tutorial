# 02-æµ‹è¯•è¦æ±‚

> æœ¬æ–‡ä»¶æ‰©å±•äº† [é€šç”¨æµ‹è¯•è§„èŒƒ](../common/testing.md)ï¼Œæ·»åŠ  TypeScript/JavaScript ç‰¹å®šå†…å®¹ã€‚

## ğŸ“‹ æ¦‚è¿°

è¿™ä¸ªè§„åˆ™å®šä¹‰äº† TypeScript/JavaScript é¡¹ç›®çš„æµ‹è¯•è¦æ±‚ï¼ŒåŒ…æ‹¬ï¼š
- **E2E æµ‹è¯•**ï¼šç«¯åˆ°ç«¯æµ‹è¯•æ¡†æ¶é€‰æ‹©
- **ä»£ç†æ”¯æŒ**ï¼šä¸“é—¨çš„æµ‹è¯•ä»£ç†

---

## 1ï¸âƒ£ E2E æµ‹è¯• (End-to-End Testing)

### ğŸ¯ ä»€ä¹ˆæ˜¯ E2E æµ‹è¯•ï¼Ÿ

**E2E æµ‹è¯•**ï¼ˆç«¯åˆ°ç«¯æµ‹è¯•ï¼‰å°±åƒæ˜¯æ¨¡æ‹ŸçœŸå®ç”¨æˆ·æ“ä½œï¼š
- æ‰“å¼€æµè§ˆå™¨
- è®¿é—®ç½‘ç«™
- ç‚¹å‡»æŒ‰é’®
- å¡«å†™è¡¨å•
- æ£€æŸ¥ç»“æœæ˜¯å¦æ­£ç¡®

### ğŸ† æ¡†æ¶é€‰æ‹©ï¼šPlaywright

æˆ‘ä»¬é€‰æ‹© **Playwright** ä½œä¸º E2E æµ‹è¯•æ¡†æ¶ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         Playwright ä¼˜åŠ¿             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ âœ… æ”¯æŒå¤šç§æµè§ˆå™¨ï¼ˆChromeã€Firefoxã€Safariï¼‰â”‚
â”‚ âœ… å¿«é€Ÿå¯é                           â”‚
â”‚ âœ… è‡ªåŠ¨ç­‰å¾…å…ƒç´ å‡ºç°                  â”‚
â”‚ âœ… å¼ºå¤§çš„è°ƒè¯•å·¥å…·                    â”‚
â”‚ âœ… TypeScript åŸç”Ÿæ”¯æŒ              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ğŸ“ E2E æµ‹è¯•ç¤ºä¾‹

```typescript
// tests/example.spec.ts
import { test, expect } from '@playwright/test'

test('ç”¨æˆ·ç™»å½•æµç¨‹', async ({ page }) => {
  // 1. è®¿é—®ç™»å½•é¡µé¢
  await page.goto('https://example.com/login')

  // 2. å¡«å†™è¡¨å•
  await page.fill('input[name="email"]', 'user@example.com')
  await page.fill('input[name="password"]', 'password123')

  // 3. ç‚¹å‡»ç™»å½•æŒ‰é’®
  await page.click('button[type="submit"]')

  // 4. éªŒè¯ç™»å½•æˆåŠŸ
  await expect(page).toHaveURL('https://example.com/dashboard')
  await expect(page.locator('h1')).toContainText('æ¬¢è¿å›æ¥')
})
```

### ğŸ¬ æµ‹è¯•è¦†ç›–çš„å…³é”®ç”¨æˆ·æµç¨‹

| æµç¨‹ç±»å‹ | æµ‹è¯•å†…å®¹ | é‡è¦æ€§ |
|---------|---------|--------|
| **èº«ä»½éªŒè¯** | ç™»å½•ã€æ³¨å†Œã€ç™»å‡º | â­â­â­â­â­ |
| **æ ¸å¿ƒåŠŸèƒ½** | è´­ç‰©è½¦ã€æ”¯ä»˜ã€æ•°æ®æäº¤ | â­â­â­â­â­ |
| **å¯¼èˆª** | é¡µé¢è·³è½¬ã€è·¯ç”± | â­â­â­â­ |
| **è¡¨å•** | è¾“å…¥éªŒè¯ã€é”™è¯¯æç¤º | â­â­â­ |

---

## 2ï¸âƒ£ ä»£ç†æ”¯æŒ (Agent Support)

### ğŸ¤– e2e-runner ä»£ç†

**e2e-runner** æ˜¯ä¸“é—¨ç”¨äº Playwright E2E æµ‹è¯•çš„ä¸“å®¶ä»£ç†ï¼š

| èƒ½åŠ› | è¯´æ˜ |
|------|------|
| **ç¼–å†™æµ‹è¯•** | è‡ªåŠ¨ç”Ÿæˆ E2E æµ‹è¯•ä»£ç  |
| **è°ƒè¯•æµ‹è¯•** | åˆ†æå¤±è´¥çš„æµ‹è¯•å¹¶æä¾›ä¿®å¤å»ºè®® |
| **ä¼˜åŒ–æµ‹è¯•** | æé«˜æµ‹è¯•é€Ÿåº¦å’Œç¨³å®šæ€§ |
| **æœ€ä½³å®è·µ** | åº”ç”¨ Playwright æœ€ä½³å®è·µ |

### ğŸ“ å¦‚ä½•ä½¿ç”¨ e2e-runnerï¼Ÿ

```bash
# åœ¨é¡¹ç›®ä¸­å¯åŠ¨ E2E æµ‹è¯•ä»£ç†
e2e-runner

# ä»£ç†ä¼šå¸®åŠ©ä½ ï¼š
# 1. åˆ†æç°æœ‰çš„æµ‹è¯•
# 2. ç¼–å†™æ–°çš„æµ‹è¯•ç”¨ä¾‹
# 3. ä¿®å¤å¤±è´¥çš„æµ‹è¯•
# 4. ä¼˜åŒ–æµ‹è¯•æ€§èƒ½
```

---

## 3ï¸âƒ£ æµ‹è¯•æœ€ä½³å®è·µ

### âœ… DOï¼ˆæ¨èåšæ³•ï¼‰

```typescript
// âœ… ä½¿ç”¨æè¿°æ€§çš„æµ‹è¯•åç§°
test('ç”¨æˆ·æˆåŠŸç™»å½•ååº”è·³è½¬åˆ°ä»ªè¡¨æ¿', async ({ page }) => {
  // ...
})

// âœ… ä½¿ç”¨ Page Object Model
class LoginPage {
  constructor(private page: Page) {}

  async login(email: string, password: string) {
    await this.page.fill('input[name="email"]', email)
    await this.page.fill('input[name="password"]', password)
    await this.page.click('button[type="submit"]')
  }
}

// âœ… ä½¿ç”¨æ•°æ®é©±åŠ¨æµ‹è¯•
const testCases = [
  { email: 'user@example.com', password: 'valid123', shouldSucceed: true },
  { email: 'invalid@example.com', password: 'wrong123', shouldSucceed: false }
]

for (const { email, password, shouldSucceed } of testCases) {
  test(`ç™»å½• ${shouldSucceed ? 'æˆåŠŸ' : 'å¤±è´¥'}: ${email}`, async ({ page }) => {
    // ...
  })
}
```

### âŒ DON'Tï¼ˆé¿å…åšæ³•ï¼‰

```typescript
// âŒ ä½¿ç”¨ç¡¬ç¼–ç çš„ç­‰å¾…æ—¶é—´
test('ç™»å½•', async ({ page }) => {
  await page.click('button')
  await page.waitForTimeout(3000)  // ä¸æ¨è
})

// âœ… æ”¹ä¸ºç­‰å¾…ç‰¹å®šæ¡ä»¶
test('ç™»å½•', async ({ page }) => {
  await page.click('button')
  await page.waitForURL('**/dashboard')  // æ¨è
})

// âŒ æµ‹è¯•ä¹‹é—´æœ‰ä¾èµ–å…³ç³»
test('æµ‹è¯• A', async ({ page }) => {
  // ä¿®æ”¹äº†å…¨å±€çŠ¶æ€
})

test('æµ‹è¯• B', async ({ page }) => {
  // ä¾èµ–äºæµ‹è¯• A çš„ç»“æœï¼ˆå±é™©ï¼ï¼‰
})

// âœ… æ¯ä¸ªæµ‹è¯•ç‹¬ç«‹è¿è¡Œ
test('æµ‹è¯• A', async ({ page }) => {
  // è®¾ç½®è‡ªå·±çš„çŠ¶æ€
})

test('æµ‹è¯• B', async ({ page }) => {
  // è®¾ç½®è‡ªå·±çš„çŠ¶æ€
})
```

---

## 4ï¸âƒ£ æµ‹è¯•æ–‡ä»¶ç»“æ„

```
project/
â”œâ”€â”€ e2e/                          # E2E æµ‹è¯•ç›®å½•
â”‚   â”œâ”€â”€ fixtures/                 # æµ‹è¯•å¤¹å…·ï¼ˆæµ‹è¯•æ•°æ®ï¼‰
â”‚   â”‚   â””â”€â”€ users.ts
â”‚   â”œâ”€â”€ pages/                    # Page Objects
â”‚   â”‚   â”œâ”€â”€ LoginPage.ts
â”‚   â”‚   â””â”€â”€ DashboardPage.ts
â”‚   â”œâ”€â”€ specs/                    # æµ‹è¯•è§„èŒƒ
â”‚   â”‚   â”œâ”€â”€ auth.spec.ts          # è®¤è¯æµ‹è¯•
â”‚   â”‚   â”œâ”€â”€ checkout.spec.ts      # ç»“è´¦æµç¨‹æµ‹è¯•
â”‚   â”‚   â””â”€â”€ navigation.spec.ts    # å¯¼èˆªæµ‹è¯•
â”‚   â””â”€â”€ utils/                    # æµ‹è¯•å·¥å…·å‡½æ•°
â”‚       â””â”€â”€ helpers.ts
â”œâ”€â”€ playwright.config.ts          # Playwright é…ç½®
â””â”€â”€ package.json
```

---

## ğŸ“ æ€»ç»“

| æ–¹é¢ | è¦æ±‚ | å·¥å…· |
|------|------|------|
| **E2E æ¡†æ¶** | Playwright | [@playwright/test](https://playwright.dev/) |
| **å…³é”®æµç¨‹** | ç™»å½•ã€æ³¨å†Œã€æ ¸å¿ƒåŠŸèƒ½ | Playwright |
| **æµ‹è¯•ä»£ç†** | e2e-runner ä¸“å®¶ | ä¸“é—¨çš„æµ‹è¯•ä»£ç† |
| **æµ‹è¯•ç»“æ„** | Page Object Model | è®¾è®¡æ¨¡å¼ |

---

## ğŸ“– ç›¸å…³èµ„æº

- **é€šç”¨æµ‹è¯•è§„èŒƒ**ï¼š[é€šç”¨æµ‹è¯•è¦æ±‚](../common/testing.md)
- **ç¼–ç é£æ ¼**ï¼š[01-ç¼–ç é£æ ¼.md](./01-ç¼–ç é£æ ¼.md)
- **Playwright å®˜æ–¹æ–‡æ¡£**ï¼š[https://playwright.dev](https://playwright.dev)
- **e2e-runner ä»£ç†**ï¼šä½¿ç”¨ `e2e-runner` å‘½ä»¤å¯åŠ¨
