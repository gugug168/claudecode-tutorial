<!--
╔══════════════════════════════════════════════════════════════════╗
║  【中文概述】                                                      ║
╠══════════════════════════════════════════════════════════════════╣
║  这个技能是做什么的:Claude Code 会话的综合验证系统                  ║
║  什么时候用它:完成功能后、创建PR前、重构后                         ║
║  核心能力:构建验证、类型检查、Lint、测试套件、安全扫描、差异审查   ║
╚══════════════════════════════════════════════════════════════════╝
-->

---
name: verification-loop
description: "A comprehensive verification system for Claude Code sessions."
---

# 验证循环技能

<!--
【说明】Claude Code 会话的综合验证系统。
-->
Claude Code 会话的综合验证系统。

<!--
【说明】何时使用:
- 完成功能或重大代码更改后
- 创建 PR 之前
- 当你想确保质量门通过时
- 重构后
-->
## 何时使用

在以下情况下调用此技能:
- 完成功能或重大代码更改后
- 创建 PR 之前
- 当你想确保质量门通过时
- 重构后

<!--
【说明】验证阶段
-->
## 验证阶段

<!--
【说明】阶段 1:构建验证。如果构建失败,停止并在继续前修复。
-->
### 阶段 1:构建验证
```bash
# 检查项目是否构建
npm run build 2>&1 | tail -20
# 或者
pnpm build 2>&1 | tail -20
```

如果构建失败,停止并在继续前修复。

<!--
【说明】阶段 2:类型检查。报告所有类型错误。在继续前修复关键错误。
-->
### 阶段 2:类型检查
```bash
# TypeScript 项目
npx tsc --noEmit 2>&1 | head -30

# Python 项目
pyright . 2>&1 | head -30
```

报告所有类型错误。在继续前修复关键错误。

<!--
【说明】阶段 3:Lint 检查
-->
### 阶段 3:Lint 检查
```bash
# JavaScript/TypeScript
npm run lint 2>&1 | head -30

# Python
ruff check . 2>&1 | head -30
```

<!--
【说明】阶段 4:测试套件。
报告:总测试数、通过、失败、覆盖率
-->
### 阶段 4:测试套件
```bash
# 运行带覆盖率的测试
npm run test -- --coverage 2>&1 | tail -50

# 检查覆盖率阈值
# 目标:最低 80%
```

报告:
- 总测试数: X
- 通过: X
- 失败: X
- 覆盖率: X%

<!--
【说明】阶段 5:安全扫描
- 检查密钥
- 检查 console.log
-->
### 阶段 5:安全扫描
```bash
# 检查密钥
grep -rn "sk-" --include="*.ts" --include="*.js" . 2>/dev/null | head -10
grep -rn "api_key" --include="*.ts" --include="*.js" . 2>/dev/null | head -10

# 检查 console.log
grep -rn "console.log" --include="*.ts" --include="*.tsx" src/ 2>/dev/null | head -10
```

<!--
【说明】阶段 6:差异审查。
审查每个更改文件的:非预期更改、缺少错误处理、潜在边缘情况
-->
### 阶段 6:差异审查
```bash
# 显示更改了什么
git diff --stat
git diff HEAD~1 --name-only
```

审查每个更改文件的:
- 非预期更改
- 缺少错误处理
- 潜在边缘情况

<!--
【说明】输出格式:运行所有阶段后,生成验证报告
-->
## 输出格式

运行所有阶段后,生成验证报告:

```
验证报告
==================

构建:     [通过/失败]
类型:     [通过/失败] (X 个错误)
Lint:      [通过/失败] (X 个警告)
测试:     [通过/失败] (X/Y 通过, Z% 覆盖率)
安全:  [通过/失败] (X 个问题)
差异:      [X 个文件已更改]

总体:   [已准备好/未准备好] 创建 PR

需要修复的问题:
1. ...
2. ...
```

<!--
【说明】持续模式:对于长时间会话,每 15 分钟或重大更改后运行验证
-->
## 持续模式

对于长时间会话,每 15 分钟或重大更改后运行验证:

```markdown
设置心理检查点:
- 完成每个函数后
- 完成组件后
- 转到下一个任务前

运行: /verify
```

<!--
【说明】与 Hooks 集成:此技能与 PostToolUse hooks 互补,但提供更深入的验证。
Hooks 立即捕获问题;此技能提供全面审查。
-->
## 与 Hooks 集成

此技能与 PostToolUse hooks 互补,但提供更深入的验证。
Hooks 立即捕获问题;此技能提供全面审查。
